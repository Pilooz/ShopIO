<style>
.barcode2D,  #miscCanvas {
	display: none;
}

#barcodeTarget, #canvasTarget {
	margin-top: 20px;
}

#barcodeTarget .gen {
	float:left;
	margin-bottom: 10px;
}
</style>

<script src="<%= APP_PATH %>/app/vendor/jquery-barcode/jquery-barcode.min.js?v=<%=APP_VERSION%>"></script>
<script type="text/javascript">

  function generateBarcode(){
  	var radical = $("#barcodeValueRadical").val();
    var value = $("#barcodeValueFrom").val();
    var value2 = $("#barcodeValueTo").val() == "" ? value : $("#barcodeValueTo").val();
    var btype = $("input[name=btype]:checked").val();
    var renderer = 'css'; // $("input[name=renderer]:checked").val();
    
	var quietZone = false;
    if ($("#quietzone").is(':checked') || $("#quietzone").attr('checked')){
      quietZone = true;
    }
	
    var settings = {
      output: renderer,
      bgColor: $("#bgColor").val(),
      color: $("#color").val(),
      barWidth: $("#barWidth").val(),
      barHeight: $("#barHeight").val(),
      moduleSize: $("#moduleSize").val(),
      posX: $("#posX").val(),
      posY: $("#posY").val(),
      addQuietZone: $("#quietZoneSize").val()
    };
    if ($("#rectangular").is(':checked') || $("#rectangular").attr('checked')){
      value = {code:value, rect: true};
    }

    // Verify if values are numbers
 	if (checkOrder(value, value2)) {

		$("#canvasTarget").hide();
		$("#barcodeTarget").html("").show();
		$("#barcodeResults .modal-title").html("<%= _t 'Barcodes' %> <%= _t 'From' %> "  + value +  " <%= _t 'To' %> " + value2);
		// Creates divs
 		for ( var v = value; v <= value2; v++ ) {
 			$("#barcodeTarget").append("<div id='code-"+ v +"' class='gen'>"+ v +"</div>");
 			$("#code-" + v ).barcode( "" + radical + v, btype, settings);
		}
 	} else {
 		
 	}
  }
  
  function checkOrder(v1, v2) {
  	v1 = v1 =="" ? 0 : v1;
  	v2 = v2 =="" ? 0 : v2;
  	if (v2 >= v1) return true;
  	else {
  		// TODO : display message on a better way
  		alert("<%= _t 'Please check values. You should put numeric values in order to generate several barcodes.' %>");
  		return false;
  	}
  } 

  function showConfig1D(){
    $('.barcode1D').show();
    $('.barcode2D').hide();
  }
  
  function showConfig2D(){
    $('.barcode1D').hide();
    $('.barcode2D').show();
  }
  
  function clearCanvas(){
    var canvas = $('#canvasTarget').get(0);
    var ctx = canvas.getContext('2d');
    ctx.lineWidth = 1;
    ctx.lineCap = 'butt';
    ctx.fillStyle = '#FFFFFF';
    ctx.strokeStyle  = '#000000';
    ctx.clearRect (0, 0, canvas.width, canvas.height);
    ctx.strokeRect (0, 0, canvas.width, canvas.height);
  }
  
  $(function(){
    $('input[name=btype]').click(function(){
      if ($(this).attr('id') == 'datamatrix') showConfig2D(); else showConfig1D();
    });

    $('#printButton').click(function(){
      print();
    });

  });

</script>

<div clas="row">
	<div class="col-md-12 col-md-offset-1">
	    <div class="col-md-4">
	      <h2><span class="label label-success"><%= _t 'Type' %></span></h2>
		      <ul class="list-group">
	 		      <li class="list-group-item">
			      	<input type="radio" name="btype" id="code11" value="code11">
			      	<label for="code11">code 11</label><span class="label label-default pull-right"><%= _t 'Numeric' %></span>
			      </li>
			      <li class="list-group-item">
			      	<input type="radio" name="btype" id="code39" value="code39" checked="checked">
			      	<label for="code39">code 39</label><span class="label label-info pull-right"><%= _t 'Alphanumeric' %></span>
			      </li>
			      <li class="list-group-item">
			      	<input type="radio" name="btype" id="code93" value="code93">
			      	<label for="code93">code 93</label><span class="label label-info pull-right"><%= _t 'Alphanumeric' %></span>
			      </li>
			      <li class="list-group-item">
			      	<input type="radio" name="btype" id="code128" value="code128">
			      	<label for="code128">code 128</label><span class="label label-info pull-right"><%= _t 'Alphanumeric' %></span>
			      </li>
	 		      <li class="list-group-item">
			      	<input type="radio" name="btype" id="datamatrix" value="datamatrix">
			      	<label for="datamatrix"><%= _t 'Data matrix' %></label><span class="label label-info pull-right"><%= _t 'Alphanumeric' %></span>
			      </li>
		      </ul>
	    </div>
	    <div class="col-md-4 col-md-offset-1">
	      <h2><span class="label label-success"><%= _t 'Micellenous' %></span></h2>
	      <ul class="list-group">
		      <li class="list-group-item">
		      	<label for="bgColor"><%= _t 'Background' %></label>
		      	<input type="text" id="bgColor" value="#FFFFFF" size="7">
		      </li>
		      <li class="list-group-item">
		      	<label for="color"><%= _t 'Bar color' %></label>
		      	<input type="text" id="color" value="#000000" size="7">
		      </li>
		      <div class="barcode1D">
		      	<li class="list-group-item">
		      		<label for="barWidth"><%= _t 'Bar width' %></label>
		        	<input type="text" id="barWidth" value="1" size="3">
		        </li>
		        <li class="list-group-item">
		        	<label for="barHeight"><%= _t 'Bar height' %></label>
		        	<input type="text" id="barHeight" value="50" size="3">
		        </li>
		      </div>

		      <div class="barcode2D">
		      <h2><span class="label label-success"><%= _t 'Module size' %></span></h2>
		      <li class="list-group-item">
			      	<label for="moduleSize"><%= _t 'Size' %></label>
			        <input type="text" id="moduleSize" value="5" size="3">
		        </li>
		        <li class="list-group-item">
			        <label for="quietZoneSize"><%= _t 'Quiet zone module' %></label>
			        <input type="text" id="quietZoneSize" value="1" size="3">
		        </li>
		        <li class="list-group-item">
			        <input type="checkbox" name="rectangular" id="rectangular">
			        <label for="rectangular"><%= _t 'Rectangular' %></label>
		        </li>
		      </div>
	      </ul>
	    </div>
	</div>
</div>

<div clas="row">
	<div class="col-md-12 col-md-offset-1">
		<div class="row">
		  <div class="col-md-6">
		    <form method="get">

		      <div class="input-group input-group-ld">
		        <span class="input-group-addon" id="codefradical">
		        	<%= _t 'Radical' %> : 
		        </span>
		        <input type="text" class="form-control" id="barcodeValueRadical" name="barcodeValueRadical" placeholder="<%=_t "Used on every barcode" %>" aria-describedby="barcodeValueRadical" value="<%= @radical %>">

		        <span class="input-group-addon" id="codefrom">
		        	<%= _t 'From' %> : 
		        </span>
		        <input type="text" class="form-control" id="barcodeValueFrom" name="barcodeValueFrom" placeholder="<%=@placeholder %>" aria-describedby="barcodeValueFrom" value="<%= @from %>">

		        <span class="input-group-addon" id="codeto">
		        	<%= _t 'To' %> : 
		        </span>
		        <input type="text" class="form-control" id="barcodeValueTo" name="barcodeValueTo" placeholder="<%=@placeholder %>" aria-describedby="barcodeValueTo" value="<%= @to %>">
		        <span class="input-group-btn">
		          <button class="btn btn-primary" type="button" onclick="generateBarcode();" data-toggle="modal" data-target="#barcodeResults"><%= _t 'Generate !' %></button>
		        </span>
		      </div>

		      </form>
		  </div>
		</div>
	</div>
</div>

<!-- Barcode are in a modal window, easier to print. -->
<div class="modal fade" id="barcodeResults" tabindex="-1" >
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title"></h4>
      </div>
      <div class="modal-body">
      	<div class="container-fluid">
			<div clas="row">
				<div class="col-md-9 col-md-offset-1">
					<div id="barcodeTarget" class="barcodeTarget"></div>
					<canvas id="canvasTarget" width="150" height="150"></canvas>
				</div>
			</div>
		</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal"><%= _t 'Close' %></button>
        <button type="button" id="printButton" class="btn btn-primary"><%= _t 'Print' %></button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div class="col-md-10 col-md-offset-1">
	<div class="table-responsive">
	<% if @items %>
		<p class="text-muted"><%=@items.count %> <%= _t 'elements in the TechShop' %></p>
	<% else %>
		<p class="text-warning"><%= _h 'help-empty-techshop' %></p>
	<% end %>
	    <table class="table table-bordered table-striped" id="techShopList">
	      <thead>
	        <tr>
	          <th>
	          	<%= _t 'Picture' %>
	          </th>
	          <th>
	          	<%= _t 'Code' %>
	          </th>
	          <th>
	          	<%= _t 'Name' %>
	          </th> 
	          <th>
	          	<%= _t 'Description' %>
	          </th>
	          <th>
	          	<%= _t 'Assigned' %> ?
	          </th>
	          <th>
	          	<%= _t 'Actions' %>
	          </th>
	        </tr>
	      </thead>
	      <tbody>
	      <% @items.each { | item | %>
	      	<% if item['checkout'] == 'O' %>
	      	<tr class='out rch'>
	        <% else %>
	        <tr class="rch">
	        <% end %>
	        	<td>
	        	<% if !item['image_link'].empty? %>
	        		<img src="<%= item['image_link'] %>" alt="<%= item['name'] %>" class="img-responsive img-rounded">
	        	<% else %>
	        		&nbsp;
	        	<% end %>
	        	</td>
	        	<td class="strikable"><%= item['code'] %></td>
	        	<td class="strikable" id="name<%= item['code'] %>"><%= item['name'] %></td>
	        	<td class="strikable"><%= item['description'] %></td>
	        	<td>
	        	<% if item['checkout'] == 'O' %>
	        		<% item['taglist'].each { | t | %>
	        			<span class="btn-xs <%= t['color'] %>"><%= t['tag'] %></span> 
	        		<% } %>
	        	<% else %>
	        	<%= _t 'Available' %>
	        	<% end %>
	        	</td>
	        	<td>
	        		<% if item['checkout'] == 'O' %>
	        		<a href="<%=APP_PATH + '/item/checkin?code=' + item['code'] %>" class="btn btn-success" id="btnCheckin"><span class="glyphicon glyphicon-import"></span></a>
	        		<% else %>
	        		<a href="<%=APP_PATH + '/out?code=' + item['code'] %>" class="btn btn-default" id="btnCheckout"><span class="glyphicon glyphicon-export"></span></a>
	        		<% end %>

 					<span class="btn btn-default btn-file" title="<%= _t 'take a picture of this item' %>">
        				 <span class="glyphicon glyphicon-camera"></span>
        				 <input type="file" class="btn btn-default" id="picture" name="picture" accept="image/*" capture="camera" />
    				</span>

 	        		<a href="<%=APP_PATH + '/modify?code=' + item['code'] %>" class="btn btn-default" id="btnModify"><span class="glyphicon glyphicon-pencil"></span></a>
	        		<a href="<%=APP_PATH + '/delete?code=' + item['code'] %>" class="btn btn-danger" id="btnDelete"><span class="btn-danger glyphicon glyphicon-trash"></span></a>
	        		</td>
	        </tr>
	      <% } %>
	      </tbody>
	    </table>
	  </div>
</div>

<script>
$(document).ready( function() {
	//
	// In Page Search engine
	//
	// Reset button
	$("#reset-filter").click(function(){
	  $("#q").val("");
	  $("table#techShopList .rch").show();
	  $("#filter-count").text("").hide();
	  $(this).hide();
	});

	// Search on keyup
	$("#q").keyup(function(){
	    var filter = $(this).val();
	    var count = 0;
	    $("#reset-filter").show();
	    // Loop through the lines list
	    $("table#techShopList .rch").each(function(){
	         // Recherche
	        if ($(this).text().search(new RegExp(filter, "ig")) < 0) {
	          $(this).fadeOut();
	        } else {
	            $(this).show();
	            count++;
	        }
	    });
	    s = count > 1 ? "s" : "";
	    $("#filter-count").text(count + " <%= _t 'result' %>" + s).show();
	  });

	//
	// Picture taking or selection events
	//
    // $('.btn-file input[type=file]').on('fileselect', function(event, numFiles, label) {
    //     console.log(numFiles);
    //     console.log(label);
    // });

    // Init States of elements
    $("#reset-filter").hide();

});

$(document).on('change', '.btn-file :file', function() {
    var input = $(this),
    numFiles = input.get(0).files ? input.get(0).files.length : 1,
    label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
	console.log("Saving " + numFiles + " file(s)");
	console.log(label);
	// Ajax.post et tout le bastringue...
});
</script>
